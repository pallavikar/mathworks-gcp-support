language: generic
dist: xenial
install: wget -qO- --retry-connrefused https://ssd.mathworks.com/supportfiles/ci/ephemeral-matlab/v0/install.sh | sudo -E bash
script: echo "## Building Google Cloud Platform dependencies"; cd matlab-gcp-common/Software/Java; mvn clean package; cd ../../../matlab-google-cloud-storage/Software/MATLAB/config; echo "## Writing Google Cloud credentials from environment variables"; echo -e "{\n \"type\":\"$type\"," > credentials.json; echo -e "\n\"project_id\":\"$project_id\"," >> credentials.json; echo -e "\n\"private_key_id\":\"$private_key_id\"," >> credentials.json; echo -e "\n\"private_key\":\"$private_key\"," >> credentials.json; echo -e "\n\"client_email\":\"$client_email\"," >> credentials.json; echo -e "\n\"client_id\":\"$client_id\"," >> credentials.json; echo -e "\n\"auth_uri\":\"$auth_uri\"," >> credentials.json; echo -e "\n\"token_uri\":\"$token_uri\"," >> credentials.json; echo -e "\n\"auth_provider_x509_cert_url\":\"$auth_provider_x509_cert_url\"," >> credentials.json; echo -e "\n\"client_x509_cert_url\":\"$client_x509_cert_url\"\n}" >> credentials.json; export GOOGLE_APPLICATION_PATH=`pwd`; export GOOGLE_APPLICATION_CREDENTIALS=$GOOGLE_APPLICATION_PATH/credentials.json; matlab -batch "cd ../../MATLAB; startup; disp('Running Unit Tests'); cd test/unit; runtests(pwd,'IncludeSubfolders',true);"

